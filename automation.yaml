env:
  contexts:
    - name: ValuelabsAdmin
      urls:
        - https://valuelabs-admin.adhoc.stabilthus.io
      includePaths:
        - https://valuelabs-admin\.adhoc\.stabilthus\.io/.*
      excludePaths:
        - https://.*auth0\.com.*

      authentication:
        method: browser
        parameters:
          loginPageUrl: https://valuelabs-admin.adhoc.stabilthus.io/
          browserId: firefox-headless
          script: /zap/wrk/auth.js   # âœ… CORRECT KEY

        verification:
          loggedInRegex: "(?i)(dashboard|accounts|logout)"
          loggedOutRegex: "(?i)(auth0|login|authorize)"

      users:
        - name: admin
          credentials:
            Username: stablehouse-admin-test@xbto.com
            Password: 7vk6N!ksBR*DkCc8EgjmvLbjWQWEj!vW

jobs:
  - type: spider
    parameters:
      context: ValuelabsAdmin
      user: admin
      maxDuration: 30
      maxDepth: 10

  - type: ajaxSpider
    parameters:
      context: ValuelabsAdmin
      user: admin
      maxDuration: 30

  - type: activeScan
    parameters:
      context: ValuelabsAdmin
      user: admin
      maxScanDurationInMins: 180

  - type: report
    parameters:
      template: traditional-html
      reportDir: /zap/wrk/zap-output
      reportFile: zap-report.html

  - type: report
    parameters:
      template: xml
      reportDir: /zap/wrk/zap-output
      reportFile: zap-report.xml
